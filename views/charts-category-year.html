{% extends 'layout.html' %}

{% block title %}
    分类支出
{% endblock %}

{% block js %}
    <script src="js/Chart.bundle.min.js"></script>
{% endblock %}

{% block content %}

    {% include "partials/navbar.html" %}

    <div class="container">
        {% include "partials/flash.html" %}
    </div>

    <div class="container" id="charts-container" style="margin-top: 10px">
        <div class="page-header">
            <h1>可视化 - 分类支出 (年)<small>    2014 ~ 2016</small></h1>
        </div>
        <div class="row mb10">
            <div class="pallete-item">
                <dl class="palette palette-alizarin">
                    <dt>食品</dt>
                </dl>
            </div>
            <div class="pallete-item">
                <dl class="palette palette-turquoise">
                    <dt>穿</dt>
                </dl>
            </div>
            <div class="pallete-item">
                <dl class="palette palette-emerald">
                    <dt>居住</dt>
                </dl>
            </div>
            <div class="pallete-item">
                <dl class="palette palette-orange">
                    <dt>交通通信</dt>
                </dl>
            </div>
            <div class="pallete-item">
                <dl class="palette palette-peter-river">
                    <dt>教育</dt>
                </dl>
            </div>
            <div class="pallete-item">
                <dl class="palette palette-amethyst">
                    <dt>文化娱乐</dt>
                </dl>
            </div>
            <div style="padding-top: 6px">
                <button class="btn btn-info pull-right" id="fullscrean">全屏</button>
            </div>

        </div>

        <div class="col-md-6 mb20">
            <div class="center-block">
                <canvas id="pie_2016"></canvas>
            </div>
        </div>
        <div class="col-md-6 mb20">
            <div class="center-block">
                <canvas id="pie_2015"></canvas>
            </div>
        </div>
        <div class="col-md-6 mb20">
            <div class="center-block">
                <canvas id="pie_2014"></canvas>
            </div>
        </div>



    </div>
{% endblock %}

{% block page-js %}
    <script>
        Chart.defaults.global.legend.display = false
        Chart.defaults.global.responsive = true
        Chart.defaults.global.hover.mode = 'single'
        Chart.defaults.global.hover.animationDuration = 300
        Chart.defaults.global.title.display = true
        Chart.defaults.global.title.position = 'top'
        Chart.defaults.global.title.fullWidth = true
        Chart.defaults.global.title.fontSize = 18
        Chart.defaults.global.animation.animateRotate = true
        Chart.defaults.global.animation.animateScale = true
        Chart.defaults.global.tooltips.enabled = true
        Chart.defaults.global.tooltips.mode = 'single'

        $('#fullscrean').on('click', function(){
            if (screenfull.enabled) {
                screenfull.toggle()
                document.addEventListener(screenfull.raw.fullscreenchange, function() {
                    if (screenfull.isFullscreen) {
                        notie.alert('success', '进入全屏展示，「ESC」退出全屏', 2)
                    } else {
                        notie.alert('success', '退出全屏展示', 2)
                    }
                })
            } else {
                notie.alert('error', '此浏览器不支持全屏', 2)
            }
        })

        var colorList = ['#E74C3C', '#1ABC9C', '#2ECC71', '#F39C12', '#3498DB', '#9B59B6']
        var pie_ctx_2016 = document.getElementById('pie_2016')
        $.getJSON('api/categorydatabyyear/2016', function(rsp) {
            var yearsData
            if (rsp.message === 0) {
                yearsData = rsp.data.data
                titleText = rsp.data.title
            } else {
                yearsData = {0: 0}
            }
            var yearsKey = []
            var yearsValue = []
            _.each(yearsData, function(value, key){
                yearsKey.push(key)
                yearsValue.push(value)
            })

            var data = {
                labels: yearsKey,
                datasets: [
                    {
                        data: yearsValue,
                        backgroundColor: colorList,
                        hoverBackgroundColor: colorList,
                    }]
            }

            var myPieChart = new Chart(pie_ctx_2016,{
                type: 'pie',
                data: data,
                options: {
                    title: {
                        text: titleText
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItems, data) {
                                return data.labels[tooltipItems.index] + '占比：' + data.datasets[0].data[tooltipItems.index] + '%';
                            }
                        }
                    }

                }
            })
        })

        var pie_ctx_2015 = document.getElementById('pie_2015')
        $.getJSON('api/categorydatabyyear/2015', function(rsp) {
            var yearsData
            if (rsp.message === 0) {
                yearsData = rsp.data.data
                titleText = rsp.data.title
            } else {
                yearsData = {0: 0}
            }
            var yearsKey = []
            var yearsValue = []
            _.each(yearsData, function(value, key){
                yearsKey.push(key)
                yearsValue.push(value)
            })

            var data = {
                labels: yearsKey,
                datasets: [
                    {
                        data: yearsValue,
                        backgroundColor: colorList,
                        hoverBackgroundColor: colorList,
                    }]
            }

            var myPieChart = new Chart(pie_ctx_2015,{
                type: 'pie',
                data: data,
                options: {
                    title: {
                        text: titleText
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItems, data) {
                                return data.labels[tooltipItems.index] + '占比：' + data.datasets[0].data[tooltipItems.index] + '%';
                            }
                        }
                    }
                }
            })
        })

        var pie_ctx_2014 = document.getElementById('pie_2014')
        $.getJSON('api/categorydatabyyear/2014', function(rsp) {
            var yearsData
            if (rsp.message === 0) {
                yearsData = rsp.data.data
                titleText = rsp.data.title
            } else {
                yearsData = {0: 0}
            }
            var yearsKey = []
            var yearsValue = []
            _.each(yearsData, function(value, key){
                yearsKey.push(key)
                yearsValue.push(value)
            })

            var data = {
                labels: yearsKey,
                datasets: [
                    {
                        data: yearsValue,
                        backgroundColor: colorList,
                        hoverBackgroundColor: colorList,
                    }]
            }

            var myPieChart = new Chart(pie_ctx_2014,{
                type: 'pie',
                data: data,
                options: {
                    title: {
                        text: titleText,
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItems, data) {
                                return data.labels[tooltipItems.index] + '占比：' + data.datasets[0].data[tooltipItems.index] + '%';
                            }
                        }
                    }
                }
            })
        })
    </script>
{% endblock %}
